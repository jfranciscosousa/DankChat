"use strict";$(function(){function e(){T=o(v.val().trim());var e=h.val();T&&(L=y.focus(),M.emit("auth user",{username:T,password:e}))}function n(){var e=y.val();e=o(e),e&&C&&(y.val(""),a({username:T,message:e}),M.emit("new message",e))}function t(e,n){var t=$("<li>").addClass("log").text(e);i(t,n)}function a(e,n){if(e.message.startsWith("/music")){var t=e.message.split(" ");return d(t[1]),void y.val("")}if(e.message.startsWith("/CARALHO"))return d("MCUq2IuY6mw"),void y.val("");var a=u(e);n=n||{},0!==a.length&&(n.fade=!1,a.remove());var s=new Date;n={hour:"2-digit",minute:"2-digit"};var o=$('<span class="username"/>').text("["+s.toLocaleTimeString("pt-PT",n)+"] "+e.username).css("color",l(e.username));e.message=Autolinker.link(e.message,{className:"myLink"});var r=$('<div class="messageBody">').html(e.message),c=$("<span>").text(":").css("color","black");o.append(c);var f=e.typing?"typing":"",m=$('<li class="message"/>').data("username",e.username).addClass(f).append(o,r);m.kappa(),i(m,n)}function s(e){var n=this;u(e).fadeOut(function(){$(n).remove()})}function i(e,n){var t=$(e);n||(n={}),"undefined"==typeof n.fade&&(n.fade=!0),"undefined"==typeof n.prepend&&(n.prepend=!1),n.fade&&t.hide().fadeIn(f),n.prepend?w.prepend(t):w.append(t),w[0].scrollTop=w[0].scrollHeight}function o(e){return $("<div/>").text(e).text()}function r(){C&&(D||(D=!0),A=(new Date).getTime(),setTimeout(function(){var e=(new Date).getTime(),n=e-A;n>=m&&D&&(D=!1)},m))}function u(e){var n=this;return $(".typing.message").filter(function(){return $(n).data("username")===e.username})}function l(e){for(var n=7,t=0;t<e.length;t++)n=e.charCodeAt(t)+(n<<5)-n;var a=Math.abs(n%g.length);return g[a]}function c(e){return e.indexOf(" ")>=0}function d(e){var n='<iframe width="300" height="300" src="https://www.youtube.com/embed/youtubeID?autoplay=1">';n=n.replace("youtubeID",e),k.html(n)}var f=150,m=400,g=["#e21400","#91580f","#f8a700","#f78b00","#58dc00","#287b00","#a8f07a","#4ae8c4","#3b88eb","#3824aa","#a700ff","#d300e7"],p=$(window),v=$("#usernameInput"),h=$("#passwordInput"),w=$(".messages"),y=$("#inputMessage"),b=$("#errorMessage"),x=$("#userList"),k=$("#youtube"),I=$(".login.page"),U=$(".chat.page"),T=void 0,C=!1,D=!1,A=void 0,L=v.focus(),M=io();p.keydown(function(t){t.ctrlKey||t.metaKey||t.altKey||!T||L.focus(),13===t.which&&(T?(n(),D=!1):c(v.val())?window.alert("No spaces allowed!"):e())});var O=!1;window.onfocus=function(){O=!1},window.onblur=function(){O=!0},y.on("input",function(){r()}),h.click(function(){h.focus()}),y.click(function(){y.focus()}),M.on("login",function(e){I.fadeOut(),U.show(),I.off("click"),C=!0;for(var n=0;n<e.loggedUsers.length;n++)e.loggedUsers[n]==T?x.append($('<li class="list-group-item active">').attr("id",e.loggedUsers[n]).text(e.loggedUsers[n])):x.append($('<li class="list-group-item">').attr("id",e.loggedUsers[n]).text(e.loggedUsers[n]))}),M.on("login-fail",function(e){b.text(e.reason),T=null}),M.on("new message",function(e){a(e);var n=document.getElementById("notif");n.volume=1,O&&n.play()}),M.on("user joined",function(e){t(e.username+" joined"),T&&x.append($('<li class="list-group-item">').attr("id",e.username).text(e.username))}),M.on("user left",function(e){t(e.username+" left"),$("#"+e.username).remove(),s(e)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsInBhc3N3b3JkIiwidXNlcm5hbWUiLCJjbGVhbklucHV0IiwiJHVzZXJuYW1lSW5wdXQiLCJ2YWwiLCJ0cmltIiwiJHBhc3N3b3JkSW5wdXQiLCJzb2NrZXQiLCIkaW5wdXRNZXNzYWdlIiwiZm9jdXMiLCJzZW5kTWVzc2FnZSIsIm1lc3NhZ2UiLCJjb25uZWN0ZWQiLCJhZGRDaGF0TWVzc2FnZSIsImVtaXQiLCJhZGRNZXNzYWdlRWxlbWVudCIsIiRlbCIsImFkZENsYXNzIiwidGV4dCIsIm9wdGlvbnMiLCJhcmdzIiwic3BsaXQiLCJwbGF5WW91dHViZUF1ZGlvIiwic3RhcnRzV2l0aCIsIiR0eXBpbmdNZXNzYWdlcyIsImxlbmd0aCIsImRhdGEiLCJmYWRlIiwicmVtb3ZlIiwiaG91ciIsIkRhdGUiLCJtaW51dGUiLCJBdXRvbGlua2VyIiwiY2xhc3NOYW1lIiwiZCIsInRvTG9jYWxlVGltZVN0cmluZyIsImNzcyIsImdldFVzZXJuYW1lQ29sb3IiLCIkbWVzc2FnZUJvZHlEaXYiLCJsaW5rIiwiJHVzZXJuYW1lRGl2IiwiJHNlcGFyYXRvciIsImh0bWwiLCIkbWVzc2FnZURpdiIsImFwcGVuZCIsInR5cGluZ0NsYXNzIiwidHlwaW5nIiwia2FwcGEiLCJyZW1vdmVDaGF0VHlwaW5nIiwiX3RoaXMiLCJ0aGlzIiwiZ2V0VHlwaW5nTWVzc2FnZXMiLCJmYWRlT3V0IiwiZWwiLCJmYWRlSW4iLCJwcmVwZW5kIiwiJG1lc3NhZ2VzIiwiaGlkZSIsIkZBREVfVElNRSIsImlucHV0Iiwic2Nyb2xsVG9wIiwic2Nyb2xsSGVpZ2h0IiwidXBkYXRlVHlwaW5nIiwibGFzdFR5cGluZ1RpbWUiLCJUWVBJTkdfVElNRVJfTEVOR1RIIiwiZ2V0VGltZSIsInNldFRpbWVvdXQiLCJ0eXBpbmdUaW1lciIsInRpbWVEaWZmIiwiX3RoaXMyIiwiaGFzaCIsIkNPTE9SUyIsImkiLCJjaGFyQ29kZUF0IiwiaW5kZXgiLCJNYXRoIiwiYWJzIiwiYXV4IiwicyIsIiR5b3V0dWJlIiwieW91dHViZUlEIiwiJHdpbmRvdyIsImtleWRvd24iLCIkZXJyb3JNZXNzYWdlIiwiJHVzZXJMaXN0IiwiJGxvZ2luUGFnZSIsIiRjaGF0UGFnZSIsIiRjdXJyZW50SW5wdXQiLCJpbyIsImV2ZW50Iiwid2hpY2giLCJ3aW5kb3ciLCJzZXRVc2VybmFtZSIsImhhc1doaXRlU3BhY2UiLCJhbGVydCIsInBsYXlOb3RpZiIsIm9uZm9jdXMiLCJvbmJsdXIiLCJvbiIsImNsaWNrIiwibG9nZ2VkVXNlcnMiLCJhdHRyIiwicmVhc29uIiwibm90aWYiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwibG9nIl0sIm1hcHBpbmdzIjoiWUFBQUEsR0FBRSxXQWtDRSxRQUFJQyxLQUNBQyxFQUFBQyxFQUFBQyxFQUFBQyxNQUFBQyxPQUNKLElBQUlKLEdBQVVLLEVBQUFGLEtBRU5ILEtBQ05NLEVBQVlDLEVBQWFDLFFBRXZCVCxFQUFBQSxLQUFVQSxhQUZaQyxTQUFBQSxFQUlERCxTQUFBQSxLQU1HLFFBQUFVLEtBQ0pDLEdBQUFBLEdBQVVULEVBQUFFLEtBRVZPLEdBQUlBLEVBQVdDLEdBRWJDLEdBQUFBLElBQ0VaLEVBQVVBLElBQUFBLElBQ1ZVLEdBRkZWLFNBQUFBLEVBSU1VLFFBQUFBLElBR1RKLEVBQUFPLEtBQUEsY0FBQUgsSUFLQ0ksUUFBQUEsR0FBQUEsRUFBa0JDLEdBQ25CLEdBQUFBLEdBQUFqQixFQUFBLFFBQUFrQixTQUFBLE9BQUFDLEtBQUFQLEVBRENJLEdBQWtCQyxFQUFLRyxHQU1yQixRQUFJQyxHQUFZVCxFQUFRVSxHQUN4QkMsR0FBQUEsRUFBQUEsUUFBQUEsV0FBQSxVQUFBLENBQ0FkLEdBQUFBLEdBQUFBLEVBQWNKLFFBQWRpQixNQUFBLElBR0FDLE9BRkFBLEdBQUFGLEVBQUEsUUFKRlosR0FLZ0JHLElBQUFBLElBRWRILEdBQUFBLEVBQWNKLFFBQWRtQixXQUFBLFlBR0UsTUFGRkQsR0FBQSxtQkFDRGQsR0FBQUosSUFBQSxHQUlE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TmhHLEVBQU8yRixHQUFHLGNBQWUsU0FBQ3hFLEdBT3hCYixFQUFBYSxFQUNGbkIsSUFBQUEsR0FBVWlHLFNBQVZDLGVBQTBCL0UsUUFDeEJnRixHQUFJaEYsT0FBS3pCLEVBQ0xBLEdBQ0ZtRixFQUFBQSxTQUlKN0UsRUFBTzJGLEdBQUcsY0FBYSxTQUFBeEUsR0FDckJnRixFQUFJaEYsRUFBS3pCLFNBQVcsV0FDbEJBLEdBQ0YrQyxFQUFBQSxPQUFpQnRCLEVBQWpCLGdDQUFBMkUsS0FBQSxLQUFBM0UsRUFBQXpCLFVBQUFpQixLQUFBUSxFQUFBekIsYUFIRk0sRUFBTzJGLEdBQUcsWUFBYSxTQUFDeEUsR0FDdEJnRixFQUFJaEYsRUFBS3pCLFNBQVcsU0FDcEJGLEVBQUUsSUFBTTJCLEVBQUt6QixVQUFVMkIsU0FDdkJvQixFQUFpQnRCIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIiQoZnVuY3Rpb24gKCkge1xuICBsZXQgRkFERV9USU1FID0gMTUwOyAvLyBtc1xuICBsZXQgVFlQSU5HX1RJTUVSX0xFTkdUSCA9IDQwMDsgLy8gbXNcbiAgbGV0IENPTE9SUyA9IFtcbiAgICBcIiNlMjE0MDBcIiwgXCIjOTE1ODBmXCIsIFwiI2Y4YTcwMFwiLCBcIiNmNzhiMDBcIixcbiAgICBcIiM1OGRjMDBcIiwgXCIjMjg3YjAwXCIsIFwiI2E4ZjA3YVwiLCBcIiM0YWU4YzRcIixcbiAgICBcIiMzYjg4ZWJcIiwgXCIjMzgyNGFhXCIsIFwiI2E3MDBmZlwiLCBcIiNkMzAwZTdcIlxuICBdO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSB2YXJpYmxlc1xuICBsZXQgJHdpbmRvdyA9ICQod2luZG93KTtcbiAgbGV0ICR1c2VybmFtZUlucHV0ID0gJChcIiN1c2VybmFtZUlucHV0XCIpOyAvLyBJbnB1dCBmb3IgdXNlcm5hbWVcbiAgbGV0ICRwYXNzd29yZElucHV0ID0gJChcIiNwYXNzd29yZElucHV0XCIpOyAvLyBJbnB1dCBmb3IgcGFzc3dvcmRcbiAgbGV0ICRtZXNzYWdlcyA9ICQoXCIubWVzc2FnZXNcIik7IC8vIE1lc3NhZ2VzIGFyZWFcbiAgbGV0ICRpbnB1dE1lc3NhZ2UgPSAkKFwiI2lucHV0TWVzc2FnZVwiKTsgLy8gSW5wdXQgbWVzc2FnZSBpbnB1dCBib3hcbiAgbGV0ICRlcnJvck1lc3NhZ2UgPSAkKFwiI2Vycm9yTWVzc2FnZVwiKTtcbiAgbGV0ICR1c2VyTGlzdCA9ICQoXCIjdXNlckxpc3RcIik7XG4gIGxldCAkeW91dHViZSA9ICQoXCIjeW91dHViZVwiKTtcblxuICBsZXQgJGxvZ2luUGFnZSA9ICQoXCIubG9naW4ucGFnZVwiKTsgLy8gVGhlIGxvZ2luIHBhZ2VcbiAgbGV0ICRjaGF0UGFnZSA9ICQoXCIuY2hhdC5wYWdlXCIpOyAvLyBUaGUgY2hhdHJvb20gcGFnZVxuXG4gICAgLy8gUHJvbXB0IGZvciBzZXR0aW5nIGEgdXNlcm5hbWVcbiAgbGV0IHVzZXJuYW1lO1xuICBsZXQgY29ubmVjdGVkID0gZmFsc2U7XG4gIGxldCB0eXBpbmcgPSBmYWxzZTtcbiAgbGV0IGxhc3RUeXBpbmdUaW1lO1xuICBsZXQgJGN1cnJlbnRJbnB1dCA9ICR1c2VybmFtZUlucHV0LmZvY3VzKCk7XG5cbiAgbGV0IHNvY2tldCA9IGlvKCk7XG5cbiAgICAvLyBTZXRzIHRoZSBjbGllbnQncyB1c2VybmFtZVxuICBmdW5jdGlvbiBzZXRVc2VybmFtZSgpIHtcbiAgICB1c2VybmFtZSA9IGNsZWFuSW5wdXQoJHVzZXJuYW1lSW5wdXQudmFsKCkudHJpbSgpKTtcbiAgICBsZXQgcGFzc3dvcmQgPSAkcGFzc3dvcmRJbnB1dC52YWwoKTtcbiAgICAgICAgLy8gSWYgdGhlIHVzZXJuYW1lIGlzIHZhbGlkXG4gICAgaWYgKHVzZXJuYW1lKSB7XG4gICAgICAkY3VycmVudElucHV0ID0gJGlucHV0TWVzc2FnZS5mb2N1cygpO1xuICAgICAgICAgICAgLy8gVGVsbCB0aGUgc2VydmVyIHlvdXIgdXNlcm5hbWVcbiAgICAgIHNvY2tldC5lbWl0KFwiYXV0aCB1c2VyXCIsIHtcbiAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gICAgLy8gU2VuZHMgYSBjaGF0IG1lc3NhZ2VcbiAgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoKSB7XG4gICAgbGV0IG1lc3NhZ2UgPSAkaW5wdXRNZXNzYWdlLnZhbCgpO1xuICAgICAgICAvLyBQcmV2ZW50IG1hcmt1cCBmcm9tIGJlaW5nIGluamVjdGVkIGludG8gdGhlIG1lc3NhZ2VcbiAgICBtZXNzYWdlID0gY2xlYW5JbnB1dChtZXNzYWdlKTtcbiAgICAgICAgLy8gaWYgdGhlcmUgaXMgYSBub24tZW1wdHkgbWVzc2FnZSBhbmQgYSBzb2NrZXQgY29ubmVjdGlvblxuICAgIGlmIChtZXNzYWdlICYmIGNvbm5lY3RlZCkge1xuICAgICAgJGlucHV0TWVzc2FnZS52YWwoXCJcIik7XG4gICAgICBhZGRDaGF0TWVzc2FnZSh7XG4gICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgbWVzc2FnZTogbWVzc2FnZVxuICAgICAgfSk7XG4gICAgICAgICAgICAvLyB0ZWxsIHNlcnZlciB0byBleGVjdXRlICduZXcgbWVzc2FnZScgYW5kIHNlbmQgYWxvbmcgb25lIHBhcmFtZXRlclxuICAgICAgc29ja2V0LmVtaXQoXCJuZXcgbWVzc2FnZVwiLCBtZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICAgIC8vIExvZyBhIG1lc3NhZ2VcbiAgZnVuY3Rpb24gbG9nKG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICBsZXQgJGVsID0gJChcIjxsaT5cIikuYWRkQ2xhc3MoXCJsb2dcIikudGV4dChtZXNzYWdlKTtcbiAgICBhZGRNZXNzYWdlRWxlbWVudCgkZWwsIG9wdGlvbnMpO1xuICB9XG5cbiAgICAvLyBBZGRzIHRoZSB2aXN1YWwgY2hhdCBtZXNzYWdlIHRvIHRoZSBtZXNzYWdlIGxpc3RcbiAgZnVuY3Rpb24gYWRkQ2hhdE1lc3NhZ2UoZGF0YSwgb3B0aW9ucykge1xuICAgIGlmIChkYXRhLm1lc3NhZ2Uuc3RhcnRzV2l0aChcIi9tdXNpY1wiKSkge1xuICAgICAgbGV0IGFyZ3MgPSBkYXRhLm1lc3NhZ2Uuc3BsaXQoXCIgXCIpO1xuICAgICAgcGxheVlvdXR1YmVBdWRpbyhhcmdzWzFdKTtcbiAgICAgICRpbnB1dE1lc3NhZ2UudmFsKFwiXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSBpZiAoZGF0YS5tZXNzYWdlLnN0YXJ0c1dpdGgoXCIvQ0FSQUxIT1wiKSkge1xuICAgICAgcGxheVlvdXR1YmVBdWRpbyhcIk1DVXEySXVZNm13XCIpO1xuICAgICAgJGlucHV0TWVzc2FnZS52YWwoXCJcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgICAgICAvLyBEb24ndCBmYWRlIHRoZSBtZXNzYWdlIGluIGlmIHRoZXJlIGlzIGFuICdYIHdhcyB0eXBpbmcnXG4gICAgbGV0ICR0eXBpbmdNZXNzYWdlcyA9IGdldFR5cGluZ01lc3NhZ2VzKGRhdGEpO1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIGlmICgkdHlwaW5nTWVzc2FnZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICBvcHRpb25zLmZhZGUgPSBmYWxzZTtcbiAgICAgICR0eXBpbmdNZXNzYWdlcy5yZW1vdmUoKTtcbiAgICB9XG5cbiAgICBsZXQgZCA9IG5ldyBEYXRlKCk7XG4gICAgb3B0aW9ucyA9IHtcbiAgICAgIGhvdXI6IFwiMi1kaWdpdFwiLFxuICAgICAgbWludXRlOiBcIjItZGlnaXRcIlxuICAgIH07XG5cbiAgICBsZXQgJHVzZXJuYW1lRGl2ID0gJChcIjxzcGFuIGNsYXNzPVxcXCJ1c2VybmFtZVxcXCIvPlwiKVxuICAgICAgICAgICAgLnRleHQoXCJbXCIgKyBkLnRvTG9jYWxlVGltZVN0cmluZyhcInB0LVBUXCIsIG9wdGlvbnMpICsgXCJdIFwiICsgZGF0YS51c2VybmFtZSlcbiAgICAgICAgICAgIC5jc3MoXCJjb2xvclwiLCBnZXRVc2VybmFtZUNvbG9yKGRhdGEudXNlcm5hbWUpKTtcblxuICAgIGRhdGEubWVzc2FnZSA9IEF1dG9saW5rZXIubGluayhkYXRhLm1lc3NhZ2UsIHtcbiAgICAgIGNsYXNzTmFtZTogXCJteUxpbmtcIlxuICAgIH0pO1xuXG4gICAgbGV0ICRtZXNzYWdlQm9keURpdiA9ICQoXCI8ZGl2IGNsYXNzPVxcXCJtZXNzYWdlQm9keVxcXCI+XCIpXG4gICAgICAgICAgICAuaHRtbChkYXRhLm1lc3NhZ2UpO1xuXG4gICAgbGV0ICRzZXBhcmF0b3IgPSAkKFwiPHNwYW4+XCIpXG4gICAgICAgICAgICAudGV4dChcIjpcIilcbiAgICAgICAgICAgIC5jc3MoXCJjb2xvclwiLCBcImJsYWNrXCIpO1xuXG4gICAgJHVzZXJuYW1lRGl2LmFwcGVuZCgkc2VwYXJhdG9yKTtcblxuICAgIGxldCB0eXBpbmdDbGFzcyA9IGRhdGEudHlwaW5nID8gXCJ0eXBpbmdcIiA6IFwiXCI7XG5cbiAgICBsZXQgJG1lc3NhZ2VEaXYgPSAkKFwiPGxpIGNsYXNzPVxcXCJtZXNzYWdlXFxcIi8+XCIpXG4gICAgICAgICAgICAuZGF0YShcInVzZXJuYW1lXCIsIGRhdGEudXNlcm5hbWUpXG4gICAgICAgICAgICAuYWRkQ2xhc3ModHlwaW5nQ2xhc3MpXG4gICAgICAgICAgICAuYXBwZW5kKCR1c2VybmFtZURpdiwgJG1lc3NhZ2VCb2R5RGl2KTtcblxuICAgICRtZXNzYWdlRGl2LmthcHBhKCk7XG5cbiAgICBhZGRNZXNzYWdlRWxlbWVudCgkbWVzc2FnZURpdiwgb3B0aW9ucyk7XG4gIH1cblxuICAgIC8qIEFkZHMgdGhlIHZpc3VhbCBjaGF0IHR5cGluZyBtZXNzYWdlXG4gICAgZnVuY3Rpb24gYWRkQ2hhdFR5cGluZyhkYXRhKSB7XG4gICAgICAgIGRhdGEudHlwaW5nID0gdHJ1ZTtcbiAgICAgICAgZGF0YS5tZXNzYWdlID0gXCJpcyB0eXBpbmdcIjtcbiAgICAgICAgYWRkQ2hhdE1lc3NhZ2UoZGF0YSk7XG4gICAgfSovXG5cbiAgICAvLyBSZW1vdmVzIHRoZSB2aXN1YWwgY2hhdCB0eXBpbmcgbWVzc2FnZVxuICBmdW5jdGlvbiByZW1vdmVDaGF0VHlwaW5nKGRhdGEpIHtcbiAgICBnZXRUeXBpbmdNZXNzYWdlcyhkYXRhKS5mYWRlT3V0KCgpID0+IHtcbiAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgfSk7XG4gIH1cblxuICAgIC8vIEFkZHMgYSBtZXNzYWdlIGVsZW1lbnQgdG8gdGhlIG1lc3NhZ2VzIGFuZCBzY3JvbGxzIHRvIHRoZSBib3R0b21cbiAgICAvLyBlbCAtIFRoZSBlbGVtZW50IHRvIGFkZCBhcyBhIG1lc3NhZ2VcbiAgICAvLyBvcHRpb25zLmZhZGUgLSBJZiB0aGUgZWxlbWVudCBzaG91bGQgZmFkZS1pbiAoZGVmYXVsdCA9IHRydWUpXG4gICAgLy8gb3B0aW9ucy5wcmVwZW5kIC0gSWYgdGhlIGVsZW1lbnQgc2hvdWxkIHByZXBlbmRcbiAgICAvLyAgIGFsbCBvdGhlciBtZXNzYWdlcyAoZGVmYXVsdCA9IGZhbHNlKVxuICBmdW5jdGlvbiBhZGRNZXNzYWdlRWxlbWVudChlbCwgb3B0aW9ucykge1xuICAgIGxldCAkZWwgPSAkKGVsKTtcblxuICAgICAgICAvLyBTZXR1cCBkZWZhdWx0IG9wdGlvbnNcbiAgICBpZiAoIW9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmZhZGUgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIG9wdGlvbnMuZmFkZSA9IHRydWU7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5wcmVwZW5kID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBvcHRpb25zLnByZXBlbmQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAgICAgLy8gQXBwbHkgb3B0aW9uc1xuICAgIGlmIChvcHRpb25zLmZhZGUpIHtcbiAgICAgICRlbC5oaWRlKCkuZmFkZUluKEZBREVfVElNRSk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnByZXBlbmQpIHtcbiAgICAgICRtZXNzYWdlcy5wcmVwZW5kKCRlbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICRtZXNzYWdlcy5hcHBlbmQoJGVsKTtcbiAgICB9XG4gICAgJG1lc3NhZ2VzWzBdLnNjcm9sbFRvcCA9ICRtZXNzYWdlc1swXS5zY3JvbGxIZWlnaHQ7XG4gIH1cblxuICAgIC8vIFByZXZlbnRzIGlucHV0IGZyb20gaGF2aW5nIGluamVjdGVkIG1hcmt1cFxuICBmdW5jdGlvbiBjbGVhbklucHV0KGlucHV0KSB7XG4gICAgcmV0dXJuICQoXCI8ZGl2Lz5cIikudGV4dChpbnB1dCkudGV4dCgpO1xuICB9XG5cbiAgICAvLyBVcGRhdGVzIHRoZSB0eXBpbmcgZXZlbnRcbiAgZnVuY3Rpb24gdXBkYXRlVHlwaW5nKCkge1xuICAgIGlmIChjb25uZWN0ZWQpIHtcbiAgICAgIGlmICghdHlwaW5nKSB7XG4gICAgICAgIHR5cGluZyA9IHRydWU7XG4gICAgICB9XG4gICAgICBsYXN0VHlwaW5nVGltZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XG5cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBsZXQgdHlwaW5nVGltZXIgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpO1xuICAgICAgICBsZXQgdGltZURpZmYgPSB0eXBpbmdUaW1lciAtIGxhc3RUeXBpbmdUaW1lO1xuICAgICAgICBpZiAodGltZURpZmYgPj0gVFlQSU5HX1RJTUVSX0xFTkdUSCAmJiB0eXBpbmcpIHtcbiAgICAgICAgICB0eXBpbmcgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSwgVFlQSU5HX1RJTUVSX0xFTkdUSCk7XG4gICAgfVxuICB9XG5cbiAgICAvLyBHZXRzIHRoZSAnWCBpcyB0eXBpbmcnIG1lc3NhZ2VzIG9mIGEgdXNlclxuICBmdW5jdGlvbiBnZXRUeXBpbmdNZXNzYWdlcyhkYXRhKSB7XG4gICAgcmV0dXJuICQoXCIudHlwaW5nLm1lc3NhZ2VcIikuZmlsdGVyKCgpID0+IHtcbiAgICAgIHJldHVybiAkKHRoaXMpLmRhdGEoXCJ1c2VybmFtZVwiKSA9PT0gZGF0YS51c2VybmFtZTtcbiAgICB9KTtcbiAgfVxuXG4gICAgLy8gR2V0cyB0aGUgY29sb3Igb2YgYSB1c2VybmFtZSB0aHJvdWdoIG91ciBoYXNoIGZ1bmN0aW9uXG4gIGZ1bmN0aW9uIGdldFVzZXJuYW1lQ29sb3IodXNlcm5hbWUpIHtcbiAgICAgICAgLy8gQ29tcHV0ZSBoYXNoIGNvZGVcbiAgICBsZXQgaGFzaCA9IDc7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1c2VybmFtZS5sZW5ndGg7IGkrKykge1xuICAgICAgaGFzaCA9IHVzZXJuYW1lLmNoYXJDb2RlQXQoaSkgKyAoaGFzaCA8PCA1KSAtIGhhc2g7XG4gICAgfVxuICAgICAgICAvLyBDYWxjdWxhdGUgY29sb3JcbiAgICBsZXQgaW5kZXggPSBNYXRoLmFicyhoYXNoICUgQ09MT1JTLmxlbmd0aCk7XG4gICAgcmV0dXJuIENPTE9SU1tpbmRleF07XG4gIH1cblxuICBmdW5jdGlvbiBoYXNXaGl0ZVNwYWNlKHMpIHtcbiAgICByZXR1cm4gcy5pbmRleE9mKFwiIFwiKSA+PSAwO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheVlvdXR1YmVBdWRpbyh5b3V0dWJlSUQpIHtcbiAgICBsZXQgYXV4ID0gXCI8aWZyYW1lIHdpZHRoPVxcXCIzMDBcXFwiIGhlaWdodD1cXFwiMzAwXFxcIiBzcmM9XFxcImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL3lvdXR1YmVJRD9hdXRvcGxheT0xXFxcIj5cIjtcbiAgICBhdXggPSBhdXgucmVwbGFjZShcInlvdXR1YmVJRFwiLCB5b3V0dWJlSUQpO1xuICAgICR5b3V0dWJlLmh0bWwoYXV4KTtcbiAgfVxuXG4gICAgLy8gS2V5Ym9hcmQgZXZlbnRzXG5cbiAgJHdpbmRvdy5rZXlkb3duKChldmVudCkgPT4ge1xuICAgICAgICAvLyBBdXRvLWZvY3VzIHRoZSBjdXJyZW50IGlucHV0IHdoZW4gYSBrZXkgaXMgdHlwZWRcbiAgICBpZiAoIShldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkgfHwgZXZlbnQuYWx0S2V5KSAmJiB1c2VybmFtZSkge1xuICAgICAgJGN1cnJlbnRJbnB1dC5mb2N1cygpO1xuICAgIH1cbiAgICAgICAgLy8gV2hlbiB0aGUgY2xpZW50IGhpdHMgRU5URVIgb24gdGhlaXIga2V5Ym9hcmRcbiAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7XG4gICAgICBpZiAodXNlcm5hbWUpIHtcbiAgICAgICAgc2VuZE1lc3NhZ2UoKTtcbiAgICAgICAgdHlwaW5nID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaGFzV2hpdGVTcGFjZSgkdXNlcm5hbWVJbnB1dC52YWwoKSkpIHtcbiAgICAgICAgICB3aW5kb3cuYWxlcnQoXCJObyBzcGFjZXMgYWxsb3dlZCFcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2V0VXNlcm5hbWUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgbGV0IHBsYXlOb3RpZiA9IGZhbHNlO1xuXG4gIHdpbmRvdy5vbmZvY3VzID0gZnVuY3Rpb24gKCkge1xuICAgIHBsYXlOb3RpZiA9IGZhbHNlO1xuICB9O1xuXG4gIHdpbmRvdy5vbmJsdXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgcGxheU5vdGlmID0gdHJ1ZTtcbiAgfTtcblxuICAkaW5wdXRNZXNzYWdlLm9uKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgIHVwZGF0ZVR5cGluZygpO1xuICB9KTtcblxuICAkcGFzc3dvcmRJbnB1dC5jbGljaygoKSA9PiB7XG4gICAgJHBhc3N3b3JkSW5wdXQuZm9jdXMoKTtcbiAgfSk7XG5cbiAgICAvLyBGb2N1cyBpbnB1dCB3aGVuIGNsaWNraW5nIG9uIHRoZSBtZXNzYWdlIGlucHV0J3MgYm9yZGVyXG4gICRpbnB1dE1lc3NhZ2UuY2xpY2soKCkgPT4ge1xuICAgICRpbnB1dE1lc3NhZ2UuZm9jdXMoKTtcbiAgfSk7XG5cbiAgICAvLyBXaGVuZXZlciB0aGUgc2VydmVyIGVtaXRzICdsb2dpbicsIGxvZyB0aGUgbG9naW4gbWVzc2FnZVxuICBzb2NrZXQub24oXCJsb2dpblwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAvL3Nob3cgdGhlIGNoYXQgcm9vbSB0byB0aGUgdXNlclxuICAgICRsb2dpblBhZ2UuZmFkZU91dCgpO1xuICAgICRjaGF0UGFnZS5zaG93KCk7XG4gICAgJGxvZ2luUGFnZS5vZmYoXCJjbGlja1wiKTtcbiAgICAgICAgLy9zZXQgaGltIGFzIGxvZ2dlZCBpblxuICAgIGNvbm5lY3RlZCA9IHRydWU7XG4gICAgICAgIC8vIERpc3BsYXkgdGhlIHdlbGNvbWUgbWVzc2FnZVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sb2dnZWRVc2Vycy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGRhdGEubG9nZ2VkVXNlcnNbaV0gPT0gdXNlcm5hbWUpIHtcbiAgICAgICAgJHVzZXJMaXN0LmFwcGVuZCgkKFwiPGxpIGNsYXNzPVxcXCJsaXN0LWdyb3VwLWl0ZW0gYWN0aXZlXFxcIj5cIikuYXR0cihcImlkXCIsIGRhdGEubG9nZ2VkVXNlcnNbaV0pLnRleHQoZGF0YS5sb2dnZWRVc2Vyc1tpXSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHVzZXJMaXN0LmFwcGVuZCgkKFwiPGxpIGNsYXNzPVxcXCJsaXN0LWdyb3VwLWl0ZW1cXFwiPlwiKS5hdHRyKFwiaWRcIiwgZGF0YS5sb2dnZWRVc2Vyc1tpXSkudGV4dChkYXRhLmxvZ2dlZFVzZXJzW2ldKSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBzb2NrZXQub24oXCJsb2dpbi1mYWlsXCIsIChkYXRhKSA9PiB7XG4gICAgJGVycm9yTWVzc2FnZS50ZXh0KGRhdGEucmVhc29uKTtcbiAgICB1c2VybmFtZSA9IG51bGw7XG4gIH0pO1xuXG4gICAgLy8gV2hlbmV2ZXIgdGhlIHNlcnZlciBlbWl0cyAnbmV3IG1lc3NhZ2UnLCB1cGRhdGUgdGhlIGNoYXQgYm9keVxuICBzb2NrZXQub24oXCJuZXcgbWVzc2FnZVwiLCAoZGF0YSkgPT4ge1xuICAgIGFkZENoYXRNZXNzYWdlKGRhdGEpO1xuICAgIGxldCBub3RpZiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibm90aWZcIik7XG4gICAgbm90aWYudm9sdW1lID0gMTtcbiAgICBpZiAocGxheU5vdGlmKSBub3RpZi5wbGF5KCk7XG4gIH0pO1xuXG4gICAgLy8gV2hlbmV2ZXIgdGhlIHNlcnZlciBlbWl0cyAndXNlciBqb2luZWQnLCBsb2cgaXQgaW4gdGhlIGNoYXQgYm9keVxuICBzb2NrZXQub24oXCJ1c2VyIGpvaW5lZFwiLCAoZGF0YSkgPT4ge1xuICAgIGxvZyhkYXRhLnVzZXJuYW1lICsgXCIgam9pbmVkXCIpO1xuICAgIGlmICh1c2VybmFtZSlcbiAgICAgICR1c2VyTGlzdC5hcHBlbmQoJChcIjxsaSBjbGFzcz1cXFwibGlzdC1ncm91cC1pdGVtXFxcIj5cIikuYXR0cihcImlkXCIsIGRhdGEudXNlcm5hbWUpLnRleHQoZGF0YS51c2VybmFtZSkpO1xuICB9KTtcblxuICAgIC8vIFdoZW5ldmVyIHRoZSBzZXJ2ZXIgZW1pdHMgJ3VzZXIgbGVmdCcsIGxvZyBpdCBpbiB0aGUgY2hhdCBib2R5XG4gIHNvY2tldC5vbihcInVzZXIgbGVmdFwiLCAoZGF0YSkgPT4ge1xuICAgIGxvZyhkYXRhLnVzZXJuYW1lICsgXCIgbGVmdFwiKTtcbiAgICAkKFwiI1wiICsgZGF0YS51c2VybmFtZSkucmVtb3ZlKCk7XG4gICAgcmVtb3ZlQ2hhdFR5cGluZyhkYXRhKTtcbiAgfSk7XG59KTtcbiJdfQ==
